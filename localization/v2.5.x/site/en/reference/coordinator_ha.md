---
id: coordinator_ha.md
summary: >-
  Learn about the motivation and procedure for Milvus coordinators to work in
  active standby.
title: Coordinator HA
---
<h1 id="Coordinator-HA" class="common-anchor-header">Coordinator HA<button data-href="#Coordinator-HA" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h1><p>As shown in the <a href="/docs/v2.5.x/architecture_overview.md">Milvus architecture</a>, Milvus consists of many components and has them work in a distributed manner. Among all the components, Milvus ensures the high availability of the workers through <a href="/docs/v2.5.x/scaleout.md">scaling up and scaling out</a> of the nodes, making coordinators the only weak link in the chain.</p>
<h2 id="Overview" class="common-anchor-header">Overview<button data-href="#Overview" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>In the 2.2.3 release, Milvus implements high availability for coordinators to make them work in the active-standby mode, mitigating possible single points of failure (SPoFs) that can result in service unavailability.</p>
<p>
  <span class="img-wrapper">
    <img translate="no" src="/docs/v2.5.x/assets/coordinator_ha.png" alt="Coordinator HA" class="doc-image" id="coordinator-ha" />
    <span>Coordinator HA</span>
  </span>
</p>
<p>The figure above illustrates how coordinators work in the active-standby mode. When a pair of coordinators start, they register with etcd using their server ID and compete for the active role. The coordinator who succeeds in leasing the active role from the etcd will start serving, and the other coordinator in the pair will remain on standby, watching the active role and ready to serve if the active coordinator dies.</p>
<h2 id="Enable-coordinator-HA" class="common-anchor-header">Enable coordinator HA<button data-href="#Enable-coordinator-HA" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><h3 id="With-Helm" class="common-anchor-header">With Helm</h3><p>To start multiple coordinators and have them work in active-standby mode, you should make the following changes to your <code translate="no">values.yaml</code> file.</p>
<ul>
<li>Set <code translate="no">xxxCoordinator.replicas</code> to <code translate="no">2</code>.</li>
<li>Set <code translate="no">xxxCoordinator.activeStandby.enabled</code> to <code translate="no">true</code>.</li>
</ul>
<p>The following code snippet uses RootCoord as an example. You can do the same to coordinators of other types.</p>
<pre><code translate="no" class="language-yaml"><span class="hljs-attr">rootCoordinator:</span>
  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
  <span class="hljs-comment"># You can set the number of replicas greater than 1 only if you also need to set activeStandby.enabled to true.</span>
  <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span>  <span class="hljs-comment"># Otherwise, remove this configuration item.</span>
  <span class="hljs-attr">resources:</span> {}
  <span class="hljs-attr">nodeSelector:</span> {}
  <span class="hljs-attr">affinity:</span> {}
  <span class="hljs-attr">tolerations:</span> []
  <span class="hljs-attr">extraEnv:</span> []
  <span class="hljs-attr">heaptrack:</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span>
  <span class="hljs-attr">profiling:</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment"># Enable live profiling</span>
  <span class="hljs-attr">activeStandby:</span>
    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment"># Set this to true to have RootCoordinators work in active-standby mode.</span>
<button class="copy-code-btn"></button></code></pre>
<h3 id="With-Docker" class="common-anchor-header">With Docker</h3><p>To start multiple coordinators and have them work in active-standby mode, you can add some definitions to the <code translate="no">docker-compose</code> file that you use to start your Milvus cluster.</p>
<p>The following code snippet uses RootCoord as an example. You can do the same to coordinators of other types.</p>
<pre><code translate="no" class="language-yaml">  <span class="hljs-attr">rootcoord:</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">milvus-rootcoord</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">milvusdb/milvus:v2.2.3</span>
    <span class="hljs-attr">command:</span> [<span class="hljs-string">&quot;milvus&quot;</span>, <span class="hljs-string">&quot;run&quot;</span>, <span class="hljs-string">&quot;rootcoord&quot;</span>]
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">ETCD_ENDPOINTS:</span> <span class="hljs-string">etcd:2379</span>
      <span class="hljs-attr">MINIO_ADDRESS:</span> <span class="hljs-string">minio:9000</span>
      <span class="hljs-attr">PULSAR_ADDRESS:</span> <span class="hljs-string">pulsar://pulsar:6650</span>
      <span class="hljs-attr">ROOT_COORD_ADDRESS:</span> <span class="hljs-string">rootcoord:53100</span>
      <span class="hljs-comment"># add ROOT_COORD_ENABLE_ACTIVE_STANDBY to enable active standby</span>
      <span class="hljs-attr">ROOT_COORD_ENABLE_ACTIVE_STANDBY:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;etcd&quot;</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;pulsar&quot;</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;minio&quot;</span>

<span class="hljs-comment">#   add the following to have RootCoords work in active-standby mode</span>
<span class="hljs-comment">#   rootcoord-1:</span>
<span class="hljs-comment">#    container_name: milvus-rootcoord-1</span>
<span class="hljs-comment">#    image: milvusdb/milvus:v2.2.3</span>
<span class="hljs-comment">#    command: [&quot;milvus&quot;, &quot;run&quot;, &quot;rootcoord&quot;]</span>
<span class="hljs-comment">#    environment:</span>
<span class="hljs-comment">#      ETCD_ENDPOINTS: etcd:2379</span>
<span class="hljs-comment">#      MINIO_ADDRESS: minio:9000</span>
<span class="hljs-comment">#      PULSAR_ADDRESS: pulsar://pulsar:6650</span>
<span class="hljs-comment">#      ROOT_COORD_ADDRESS: rootcoord-1:53100</span>
<span class="hljs-comment">#      # add ROOT_COORD_ENABLE_ACTIVE_STANDBY to enable active standby</span>
<span class="hljs-comment">#      ROOT_COORD_ENABLE_ACTIVE_STANDBY: true</span>
<span class="hljs-comment">#    depends_on:</span>
<span class="hljs-comment">#      - &quot;etcd&quot;</span>
<span class="hljs-comment">#      - &quot;pulsar&quot;</span>
<span class="hljs-comment">#      - &quot;minio&quot;</span>
<button class="copy-code-btn"></button></code></pre>
<h3 id="With-MacLinux-shell" class="common-anchor-header">With Mac/Linux shell</h3><p>To start multiple coordinators and have them work in active-standby mode, you can</p>
<ol>
<li><p>Download the Milvus source code to your local drive, and <a href="https://github.com/milvus-io/milvus/blob/master/DEVELOPMENT.md">start up a Milvus cluster from the source code</a> as follows:</p>
<pre><code translate="no" class="language-shell">sudo ./scripts/start_cluster.sh
<button class="copy-code-btn"></button></code></pre>
<p>Milvus runs with only one coordinator of each type at the end of this step.</p></li>
<li><p>Update <code translate="no">milvus.yaml</code> to change the port number of the coordinator of each type. The following uses <strong>rootCoord</strong> as an example.</p>
<pre><code translate="no" class="language-yaml"><span class="hljs-attr">rootCoord:</span>
  <span class="hljs-attr">address:</span> <span class="hljs-string">localhost</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">53100</span> <span class="hljs-comment"># change to 53001</span>
<button class="copy-code-btn"></button></code></pre></li>
<li><p>Start the standby coordinator.</p>
<pre><code translate="no" class="language-shell">sudo nohup ./bin/milvus run rootcoord &gt; /tmp/rootcoord2.log 2&gt;&amp;1 &amp;
<button class="copy-code-btn"></button></code></pre>
<p>At the end of this step, run the following command to verify that two coordinator processes exists.</p>
<pre><code translate="no" class="language-shell">ps aux|grep milvus
<button class="copy-code-btn"></button></code></pre>
<p>The output should be similar to</p>
<pre><code translate="no" class="language-shell"><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">ps aux|grep milvus</span>
root        12813   0.7 0.2 410709648   82432   ??  S   5:18PM  0:33.28 ./bin/milvus run rootcoord
root        12816   0.5 0.2 409487968   62352   ??  S   5:18PM  0:22.69 ./bin/milvus run proxy
root        17739   0.1 0.3 410289872   91792 s003  SN  6:01PM  0:00.30 ./bin/milvus run rootcoord
...
<button class="copy-code-btn"></button></code></pre>
<p>And the standby coordinator outputs a log entry every ten seconds as follows:</p>
<pre><code translate="no" class="language-shell">[INFO] [sessionutil/session_util.go:649] [&quot;serverName: rootcoord is in STANDBY ...&quot;]
<button class="copy-code-btn"></button></code></pre></li>
<li><p>Kill the active coordinator in a pair and watch the behavior of the standby coordinator.</p>
<p>You can find that it takes 60 seconds for the standby coordinator to take over the active role.</p>
<pre><code translate="no" class="language-shell">[2022/09/21 11:58:33.855 +08:00] [DEBUG] [sessionutil/session_util.go:677] [&quot;watch the ACTIVE key&quot;] [DELETE=&quot;key:\&quot;by-dev/meta/session/rootcoord\&quot; mod_revision:167 &quot;]
[2022/09/21 11:58:33.856 +08:00] [DEBUG] [sessionutil/session_util.go:677] [&quot;watch the ACTIVE key&quot;] [DELETE=&quot;key:\&quot;by-dev/meta/session/rootcoord-15\&quot; mod_revision:167 &quot;]
[2022/09/21 11:58:33.856 +08:00] [INFO] [sessionutil/session_util.go:683] [&quot;stop watching ACTIVE key&quot;]
[2022/09/21 11:58:33.856 +08:00] [INFO] [sessionutil/session_util.go:655] [&quot;start retrying to register as ACTIVE service...&quot;]
[2022/09/21 11:58:33.859 +08:00] [INFO] [sessionutil/session_util.go:641] [&quot;register ACTIVE service successfully&quot;] [ServerID=19]
[2022/09/21 11:58:33.859 +08:00] [INFO] [sessionutil/session_util.go:690] [&quot;quit STANDBY mode, this node will become ACTIVE&quot;]
[2022/09/21 11:58:33.859 +08:00] [INFO] [rootcoord/root_coord.go:638] [&quot;rootcoord switch from standby to active, activating&quot;]
[2022/09/21 11:58:33.859 +08:00] [INFO] [rootcoord/root_coord.go:306] [&quot;RootCoord Register Finished&quot;]
[2022/09/21 11:58:33.859 +08:00] [DEBUG] [rootcoord/service.go:148] [&quot;RootCoord start done ...&quot;]
[2022/09/21 11:58:33.859 +08:00] [DEBUG] [components/root_coord.go:58] [&quot;RootCoord successfully started&quot;]
<button class="copy-code-btn"></button></code></pre></li>
</ol>
<h2 id="Related-configuration-items" class="common-anchor-header">Related configuration items<button data-href="#Related-configuration-items" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>Coordinator HA is disabled by default. You can enable this feature manually by changing the following items in your Milvus configuration file.</p>
<ul>
<li><a href="/docs/v2.5.x/configure_rootcoord.md#rootCoordactiveStandbyenabled">rootCoord.activeStandby.enabled</a></li>
<li><a href="/docs/v2.5.x/configure_querycoord.md#queryCoordactiveStandbyenabled">queryCoord.activeStandby.enabled</a></li>
<li><a href="/docs/v2.5.x/configure_datacoord.md#dataCoordactiveStandbyenabled">dataCoord.activeStandby.enabled</a></li>
</ul>
<h2 id="Limits" class="common-anchor-header">Limits<button data-href="#Limits" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>Currently, there is no strong consistency guarantee between the active and standby service. Therefore, the standby coordinator needs to reload the metadata while taking over the active role.</p>
<p>Etcd releases a lease only after the current session has timed out. The session timeout defaults to 60 seconds. Therefore, there is a 60-second gap between when the active coordinator dies and when the standby coordinator takes over the active role.</p>

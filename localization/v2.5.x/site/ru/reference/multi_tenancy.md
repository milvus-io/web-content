---
id: multi_tenancy.md
related_key: multi-tenancy
summary: Многопользовательский режим в Milvus.
title: Стратегии работы с несколькими арендаторами
---
<h1 id="Multi-tenancy-strategies" class="common-anchor-header">Стратегии работы с несколькими арендаторами<button data-href="#Multi-tenancy-strategies" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h1><p>Во многих случаях разработчики хотят запустить один кластер Milvus и обслуживать несколько арендаторов, например, несколько продуктовых команд или миллионы конечных пользователей. В этом руководстве описано несколько различных стратегий для достижения многопользовательского режима в Milvus.</p>
<p>Milvus разработан для поддержки многопользовательского доступа на уровне баз данных, коллекций или разделов. Цель многопользовательской аренды - отделить данные и ресурсы друг от друга. Реализация многопользовательского доступа на разных уровнях позволяет достичь различной степени изоляции, но также влечет за собой различные накладные расходы. Здесь мы расскажем о компромиссах между ними.</p>
<h2 id="Database-oriented-multi-tenancy" class="common-anchor-header">Мультитенантность, ориентированная на базу данных<button data-href="#Database-oriented-multi-tenancy" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>Начиная с версии 2.2.9 Milvus, вы можете создавать несколько баз данных в одном кластере Milvus. Эта возможность позволяет достичь ориентированной на базу данных многопользовательской сети, назначая базу данных для каждого арендатора, чтобы они могли создавать свои собственные коллекции. Такой подход обеспечивает наилучшую изоляцию данных и ресурсов для арендаторов, однако он ограничен максимум 64 базами данных в одном кластере.</p>
<h2 id="Collection-oriented-multi-tenancy" class="common-anchor-header">Мультитенантность, ориентированная на коллекции<button data-href="#Collection-oriented-multi-tenancy" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>Существует два возможных пути достижения ориентированной на коллекции многопользовательской среды.</p>
<h3 id="One-collection-for-all-tenants" class="common-anchor-header">Одна коллекция для всех арендаторов</h3><p>Использование одной коллекции для реализации многопользовательского доступа путем добавления поля tenant для различения арендаторов - простой вариант. При выполнении поиска ANN для конкретного арендатора добавьте выражение фильтра, чтобы отсеять все сущности, принадлежащие другим арендаторам. Это самый простой способ добиться многопользовательского доступа. Однако имейте в виду, что производительность фильтра может стать узким местом ANN-поиска. Чтобы повысить производительность поиска, можно оптимизировать многопользовательскую работу, ориентированную на разделы.</p>
<h3 id="One-collection-per-tenant" class="common-anchor-header">Одна коллекция для каждого арендатора</h3><p>Другой подход заключается в создании коллекции для каждого арендатора для хранения его собственных данных, вместо того чтобы хранить данные всех арендаторов в одной коллекции. Это обеспечивает лучшую изоляцию данных и производительность запросов. Однако следует помнить, что такой подход требует больше ресурсов для планирования и ограничен максимум 10 000 коллекций в кластере.</p>
<h2 id="Partition-oriented-multi-tenancy" class="common-anchor-header">Ориентированное на разделы многопользовательское использование<button data-href="#Partition-oriented-multi-tenancy" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>Существует два способа достижения ориентированной на разделы многопользовательской сети:</p>
<h3 id="One-partition-per-tenant" class="common-anchor-header">Один раздел на одного арендатора</h3><p>Управлять одной коллекцией гораздо проще, чем несколькими. Вместо того чтобы создавать несколько коллекций, подумайте о назначении раздела для каждого арендатора, чтобы добиться гибкой изоляции данных и управления памятью. Производительность поиска при ориентированном на разделы многопользовательстве гораздо выше, чем при ориентированном на коллекции многопользовательстве. Однако следует учитывать, что количество арендаторов коллекции не должно превышать максимальное количество разделов, которые может содержать коллекция.</p>
<h3 id="Partition-key-based-multi-tenancy" class="common-anchor-header">Мультиарендаторство на основе ключей разделов</h3><p>В Milvus 2.2.9 появилась новая функция под названием "ключ раздела". При создании коллекции назначьте поле арендатора и сделайте его полем ключа раздела. Milvus будет хранить сущности в разделе в соответствии с хэш-значением поля ключа раздела. При выполнении поиска по ANN Milvus будет искать только в том разделе, который содержит ключ раздела. Это значительно сокращает объем поиска и обеспечивает более высокую производительность по сравнению с поиском без ключа раздела.</p>
</div>
<p>Эта стратегия снимает ограничение на максимальное количество арендаторов, которое может поддерживать коллекция Milvus, и значительно упрощает управление ресурсами, поскольку Milvus автоматически управляет разделами за вас.</p>
<p>Итак, вы можете использовать одну или несколько из описанных выше стратегий многопользовательской работы для создания собственного решения. В следующей таблице приведены сравнения между этими стратегиями с точки зрения изоляции данных, производительности поиска и максимального количества арендаторов.</p>
<table>
<thead>
<tr><th></th><th>Изоляция данных</th><th>Производительность поиска</th><th>Максимальное количество арендаторов</th><th>Рекомендуемые сценарии</th></tr>
</thead>
<tbody>
<tr><td>Ориентированная на базу данных</td><td>Сильный</td><td>Сильный</td><td>64</td><td>Для тех, кому требуется, чтобы коллекции менялись в зависимости от проекта, особенно подходит для изоляции данных между отделами вашей организации.</td></tr>
<tr><td>Одна коллекция для всех</td><td>Слабая</td><td>Средняя</td><td>Н/А</td><td>Для тех, кто имеет ограниченные ресурсы и нечувствителен к изоляции данных.</td></tr>
<tr><td>Одна коллекция на одного арендатора</td><td>Сильная</td><td>Сильная</td><td>Менее 10 000</td><td>Для тех, у кого менее 10 000 арендаторов на кластер.</td></tr>
<tr><td>Один раздел на одного арендатора</td><td>Средний</td><td>Сильный</td><td>4,096</td><td>Для тех, у кого менее 4 096 арендаторов на кластер.</td></tr>
<tr><td>на основе ключей разделов</td><td>Средний</td><td>Сильная</td><td>10,000,000+</td><td>Для тех, кто прогнозирует быстрый рост числа арендаторов до миллионов.</td></tr>
</tbody>
</table>
<h2 id="Whats-next" class="common-anchor-header">Что дальше<button data-href="#Whats-next" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p><a href="/docs/ru/manage_databases.md">Управление</a><a href="/docs/ru/schema.md">схемами</a><a href="/docs/ru/manage_databases.md">баз данных</a></p>

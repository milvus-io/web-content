{"codeList":["pip install pymilvus datasketch numpy\n","from datasketch import MinHash\nimport numpy as np\n\nMINHASH_DIM = 256\nHASH_BIT_WIDTH = 64\n\ndef generate_minhash_signature(text, num_perm=MINHASH_DIM) -> bytes:\n    m = MinHash(num_perm=num_perm)\n    for token in text.lower().split():\n        m.update(token.encode(\"utf8\"))\n    return m.hashvalues.astype('>u8').tobytes()  # Returns 2048 bytes\n","def extract_token_set(text: str) -> str:\n    tokens = set(text.lower().split())\n    return \" \".join(tokens)\n","from pymilvus import MilvusClient\n\nclient = MilvusClient(uri=\"http://localhost:19530\")  # Update if your URI is different\n","from pymilvus import DataType\n\nVECTOR_DIM = MINHASH_DIM * HASH_BIT_WIDTH  # 256 × 64 = 8192 bits\n\nschema = client.create_schema(auto_id=False, enable_dynamic_field=False)\nschema.add_field(\"doc_id\", DataType.INT64, is_primary=True)\nschema.add_field(\"minhash_signature\", DataType.BINARY_VECTOR, dim=VECTOR_DIM)\nschema.add_field(\"token_set\", DataType.VARCHAR, max_length=1000)  # required for refinement\nschema.add_field(\"document\", DataType.VARCHAR, max_length=1000)\n","index_params = client.prepare_index_params()\nindex_params.add_index(\n    field_name=\"minhash_signature\",\n    index_type=\"MINHASH_LSH\",\n    metric_type=\"MHJACCARD\",\n    params={\n        \"mh_element_bit_width\": HASH_BIT_WIDTH,  # Must match signature bit width\n        \"mh_lsh_band\": 16,                       # Band count (128/16 = 8 hashes per band)\n        \"with_raw_data\": True                    # Required for Jaccard refinement\n    }\n)\n\nclient.create_collection(\"minhash_demo\", schema=schema, index_params=index_params)\n","documents = [\n    \"machine learning algorithms process data automatically\",\n    \"deep learning uses neural networks to model patterns\"\n]\n\ninsert_data = []\nfor i, doc in enumerate(documents):\n    sig = generate_minhash_signature(doc)\n    token_str = extract_token_set(doc)\n    insert_data.append({\n        \"doc_id\": i,\n        \"minhash_signature\": sig,\n        \"token_set\": token_str,\n        \"document\": doc\n    })\n\nclient.insert(\"minhash_demo\", insert_data)\nclient.flush(\"minhash_demo\")\n","query_text = \"neural networks model patterns in data\"\nquery_sig = generate_minhash_signature(query_text)\n","# highlight-start\nsearch_params={\n    \"metric_type\": \"MHJACCARD\", \n    \"params\": {}\n}\n# highlight-end\n\napprox_results = client.search(\n    collection_name=\"minhash_demo\",\n    data=[query_sig],\n    anns_field=\"minhash_signature\",\n    # highlight-next-line\n    search_params=search_params,\n    limit=3,\n    output_fields=[\"doc_id\", \"document\"],\n    consistency_level=\"Strong\"\n)\n\nfor i, hit in enumerate(approx_results[0]):\n    sim = 1 - hit['distance']\n    print(f\"{i+1}. Similarity: {sim:.3f} | {hit['entity']['document']}\")\n","# highlight-start\nsearch_params = {\n    \"metric_type\": \"MHJACCARD\",\n    \"params\": {\n        \"mh_search_with_jaccard\": True,  # Enable real Jaccard computation\n        \"refine_k\": 5                    # Refine top 5 candidates\n    }\n}\n# highlight-end\n\nrefined_results = client.search(\n    collection_name=\"minhash_demo\",\n    data=[query_sig],\n    anns_field=\"minhash_signature\",\n    # highlight-next-line\n    search_params=search_params,\n    limit=3,\n    output_fields=[\"doc_id\", \"document\"],\n    consistency_level=\"Strong\"\n)\n\nfor i, hit in enumerate(refined_results[0]):\n    sim = 1 - hit['distance']\n    print(f\"{i+1}. Similarity: {sim:.3f} | {hit['entity']['document']}\")\n"],"headingContent":"MINHASH_LSH","anchorList":[{"label":"MINHASH_LSH","href":"MINHASHLSH","type":1,"isActive":false},{"label":"Überblick","href":"Overview","type":2,"isActive":false},{"label":"Voraussetzungen","href":"Prerequisites","type":2,"isActive":false},{"label":"Verwendung von MinHash LSH in Milvus","href":"Use-MinHash-LSH-in-Milvus","type":2,"isActive":false},{"label":"Index-Parameter","href":"Index-params","type":2,"isActive":false}]}
{"codeList":["kubectl -n default port-forward deploy/my-release-milvus-proxy 9091:9091 &​\n","[1] 8116​\nForwarding from 127.0.0.1:9091 -> 9091​\n\n","pid=8116​\n\n","curl 127.0.0.1:9091/api/v1/collections \\​\n|curl 127.0.0.1:9091/api/v1/persist -d @/dev/stdin\\​\n|jq '.flush_coll_segIDs'| jq '[.[] | .data[]]' | jq '{segmentIDs: (.)}' \\​\n> flushing_segments.json​\ncat flushing_segments.json​\n\n","{​\n  \"segmentIDs\": [​\n    454097953998181000,​\n    454097953999383600,​\n    454097953998180800​\n  ]​\n}​\n\n","cat flushing_segments.json|  curl -X GET 127.0.0.1:9091/api/v1/persist/state -d @/dev/stdin ​\n\n","{\"status\":{},\"flushed\":true}​\n\n","kill $pid​\n\n","[1]  + 8116 terminated  kubectl -n default port-forward deploy/my-release-milvus-proxy 9091:9091                      ​\n\n","helm -n default get values my-release -o yaml > values.yaml​\ncat values.yaml​\n\n","helm -n default uninstall my-release​\n\n","These resources were kept due to the resource policy:​\n[PersistentVolumeClaim] my-release-minio​\n​\nrelease \"my-release\" uninstalled​\n\n","kubectl -n default get pvc -lapp=pulsar,release=my-release |grep -v NAME |awk '{print $1}' > pulsar-pvcs.txt​\nkubectl -n default get pvc -lapp=pulsar,release=my-release -o custom-columns=VOL:.spec.volumeName|grep -v VOL > pulsar-pvs.txt​\necho \"Volume Claims:\"​\ncat pulsar-pvcs.txt​\necho \"Volumes:\"​\ncat pulsar-pvs.txt​\n\n","Volume Claims:​\nmy-release-pulsar-bookie-journal-my-release-pulsar-bookie-0​\nmy-release-pulsar-bookie-journal-my-release-pulsar-bookie-1​\nmy-release-pulsar-bookie-ledgers-my-release-pulsar-bookie-0​\nmy-release-pulsar-bookie-ledgers-my-release-pulsar-bookie-1​\nmy-release-pulsar-zookeeper-data-my-release-pulsar-zookeeper-0​\nVolumes:​\npvc-f590a4de-df31-4ca8-a424-007eac3c619a​\npvc-17b0e215-3e14-4d14-901e-1a1dda9ff5a3​\npvc-72f83c25-6ea1-45ee-9559-0b783f2c530b​\npvc-60dcb6e4-760d-46c7-af1a-d1fc153b0caf​\npvc-2da33f64-c053-42b9-bb72-c5d50779aa0a​\n\n","cat pulsar-pvcs.txt |xargs -I {} kubectl -n default delete pvc {} --wait=false​\n\n","persistentvolumeclaim \"my-release-pulsar-bookie-journal-my-release-pulsar-bookie-0\" deleted​\npersistentvolumeclaim \"my-release-pulsar-bookie-journal-my-release-pulsar-bookie-1\" deleted​\npersistentvolumeclaim \"my-release-pulsar-bookie-ledgers-my-release-pulsar-bookie-0\" deleted​\npersistentvolumeclaim \"my-release-pulsar-bookie-ledgers-my-release-pulsar-bookie-1\" deleted​\npersistentvolumeclaim \"my-release-pulsar-zookeeper-data-my-release-pulsar-zookeeper-0\" deleted​\n\n","cat pulsar-pvs.txt |xargs -I {} kubectl -n default delete pvc {} --wait=false​\n\n","Error from server (NotFound): persistentvolumeclaims \"pvc-f590a4de-df31-4ca8-a424-007eac3c619a\" not found​\nError from server (NotFound): persistentvolumeclaims \"pvc-17b0e215-3e14-4d14-901e-1a1dda9ff5a3\" not found​\nError from server (NotFound): persistentvolumeclaims \"pvc-72f83c25-6ea1-45ee-9559-0b783f2c530b\" not found​\nError from server (NotFound): persistentvolumeclaims \"pvc-60dcb6e4-760d-46c7-af1a-d1fc153b0caf\" not found​\nError from server (NotFound): persistentvolumeclaims \"pvc-2da33f64-c053-42b9-bb72-c5d50779aa0a\" not found​\n\n","kubectl -n default get milvus my-release -o yaml > milvus.yaml​\nhead milvus.yaml -n 20​\n\n","apiVersion: milvus.io/v1beta1​\nkind: Milvus​\nmetadata:​\n  annotations:​\n    milvus.io/dependency-values-merged: \"true\"​\n    milvus.io/pod-service-label-added: \"true\"​\n    milvus.io/querynode-current-group-id: \"0\"​\n  creationTimestamp: \"2024-11-22T08:06:59Z\"​\n  finalizers:​\n  - milvus.milvus.io/finalizer​\n  generation: 3​\n  labels:​\n    app: milvus​\n    milvus.io/operator-version: 1.1.2​\nname: my-release​\nnamespace: default​\nresourceVersion: \"692217324\"​\nuid: 7a469ed0-9df1-494e-bd9a-340fac4305b5​\nspec:​\n  components:​\n\n","# a patch to retain etcd & storage data and delete pulsar data while delete milvus​\nspec:​\n  dependencies:​\n    etcd:​\n      inCluster:​\n        deletionPolicy: Retain​\n        pvcDeletion: false​\n    storage:​\n      inCluster:​\n        deletionPolicy: Retain​\n        pvcDeletion: false​\n    pulsar:​\n      inCluster:​\n        deletionPolicy: Delete​\n        pvcDeletion: true​\n\n","kubectl -n default patch milvus my-release --patch-file patch.yaml --type=merge​\n\n","milvus.milvus.io/my-release patched​\n\n","kubectl -n default delete milvus my-release --wait=false​\nkubectl -n default get milvus my-release​\nkubectl -n default delete milvus my-release --wait=true​\n\n","milvus.milvus.io \"my-release\" deleted​\nNAME         MODE      STATUS     UPDATED   AGE​\nmy-release   cluster   Deleting   True      41m​\nmilvus.milvus.io \"my-release\" deleted​\n\n","kubectl -n default get milvus my-release​\n\n","No resources found in default namespace.​\n\n","# change the following:​\npulsar:​\n  enabled: false # set to false​\n  # you may also clean up rest fields under pulsar field​\n  # it's ok to keep them though.​\npulsarv3:​\n  enabled: true​\n  # append other values for pulsar v3 chart if needs​\n\n","helm repo add zilliztech https://zilliztech.github.io/milvus-helm​\nhelm repo update zilliztech​\n\n","\"zilliztech\" already exists with the same configuration, skipping​\nHang tight while we grab the latest from your chart repositories...​\n...Successfully got an update from the \"zilliztech\" chart repository​\nUpdate Complete. ⎈Happy Helming!⎈​\n\n","helm -n default install my-release zilliztech/milvus --reset-values -f values.yaml​\n\n","NAME: my-release​\nLAST DEPLOYED: Fri Nov 22 15:31:27 2024​\nNAMESPACE: default​\nSTATUS: deployed​\nREVISION: 1​\nTEST SUITE: None​\n\n","NAME                                          READY   STATUS      RESTARTS   AGE​\nmy-release-etcd-0                             1/1     Running     0          4m3s​\nmy-release-milvus-datanode-56487bc4bc-s6mbd   1/1     Running     0          4m5s​\nmy-release-milvus-indexnode-6476894d6-rv85d   1/1     Running     0          4m5s​\nmy-release-milvus-mixcoord-6d8875cb9c-67fcq   1/1     Running     0          4m4s​\nmy-release-milvus-proxy-7bc45d57c5-2qf8m      1/1     Running     0          4m4s​\nmy-release-milvus-querynode-77465747b-kt7f4   1/1     Running     0          4m4s​\nmy-release-minio-684ff4f5df-pnc97             1/1     Running     0          4m5s​\nmy-release-pulsarv3-bookie-0                  1/1     Running     0          4m3s​\nmy-release-pulsarv3-bookie-1                  1/1     Running     0          4m3s​\nmy-release-pulsarv3-bookie-2                  1/1     Running     0          4m3s​\nmy-release-pulsarv3-bookie-init-6z4tk         0/1     Completed   0          4m1s​\nmy-release-pulsarv3-broker-0                  1/1     Running     0          4m2s​\nmy-release-pulsarv3-broker-1                  1/1     Running     0          4m2s​\nmy-release-pulsarv3-proxy-0                   1/1     Running     0          4m2s​\nmy-release-pulsarv3-proxy-1                   1/1     Running     0          4m2s​\nmy-release-pulsarv3-pulsar-init-wvqpc         0/1     Completed   0          4m1s​\nmy-release-pulsarv3-recovery-0                1/1     Running     0          4m3s​\nmy-release-pulsarv3-zookeeper-0               1/1     Running     0          4m2s​\nmy-release-pulsarv3-zookeeper-1               1/1     Running     0          4m2s​\nmy-release-pulsarv3-zookeeper-2               1/1     Running     0          4m2s​\n\n","# change the followings fields:​\napiVersion: milvus.io/v1beta1​\nkind: Milvus​\nmetadata:​\n  annotations: null # this field should be removed or set to null​\n  resourceVersion: null # this field should be removed or set to null​\n  uid: null # this field should be removed or set to null​\nspec:​\n  dependencies:​\n    pulsar:​\n      inCluster:​\n        chartVersion: pulsar-v3​\n        # delete all previous values for pulsar v2 and set it to null.​\n        # you may add additional values here for pulsar v3 if you're sure about it.​\n        values: null​\n\n","helm repo add milvus-operator https://zilliztech.github.io/milvus-operator​\nhelm repo update milvus-operator​\nhelm -n milvus-operator upgrade milvus-operator milvus-operator/milvus-operator​\n\n","kubectl create -f milvus.yaml​\n\n","milvus.milvus.io/my-release created​\n\n","NAME                                            READY   STATUS      RESTARTS   AGE​\nmy-release-etcd-0                               1/1     Running     0          65m​\nmy-release-milvus-datanode-57fd59ff58-5mdrk     1/1     Running     0          93s​\nmy-release-milvus-indexnode-67867c6b9b-4wsbw    1/1     Running     0          93s​\nmy-release-milvus-mixcoord-797849f9bb-sf8z5     1/1     Running     0          93s​\nmy-release-milvus-proxy-5d5bf98445-c55m6        1/1     Running     0          93s​\nmy-release-milvus-querynode-0-64797f5c9-lw4rh   1/1     Running     0          92s​\nmy-release-minio-79476ccb49-zvt2h               1/1     Running     0          65m​\nmy-release-pulsar-bookie-0                      1/1     Running     0          5m10s​\nmy-release-pulsar-bookie-1                      1/1     Running     0          5m10s​\nmy-release-pulsar-bookie-2                      1/1     Running     0          5m10s​\nmy-release-pulsar-bookie-init-v8fdj             0/1     Completed   0          5m11s​\nmy-release-pulsar-broker-0                      1/1     Running     0          5m11s​\nmy-release-pulsar-broker-1                      1/1     Running     0          5m10s​\nmy-release-pulsar-proxy-0                       1/1     Running     0          5m11s​\nmy-release-pulsar-proxy-1                       1/1     Running     0          5m10s​\nmy-release-pulsar-pulsar-init-5lhx7             0/1     Completed   0          5m11s​\nmy-release-pulsar-recovery-0                    1/1     Running     0          5m11s​\nmy-release-pulsar-zookeeper-0                   1/1     Running     0          5m11s​\nmy-release-pulsar-zookeeper-1                   1/1     Running     0          5m10s​\nmy-release-pulsar-zookeeper-2                   1/1     Running     0          5m10s​\n\n"],"headingContent":"Upgrading Pulsar ​","anchorList":[{"label":"升級 Pulsar","href":"Upgrading-Pulsar-​","type":1,"isActive":false},{"label":"路線圖","href":"Roadmap","type":2,"isActive":false},{"label":"步驟","href":"Procedures","type":2,"isActive":false}]}